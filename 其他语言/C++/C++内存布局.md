# C内存布局

主要分为以下几部分：

1. 代码段
2. 初始化数据段(数据段)
3. 为初始化数据段(BSS段)
4. 堆
5. 栈

![](https://s2.ax1x.com/2019/11/02/Kq7L80.png)

## 代码段

代码段是由程序中的机器代码组成，在C语言中，程序经过编译后，形成机器代码。在执行过程中，CPU的程序计数器指向代码段中的一条指令，一次执行。

## 初始化数据段

初始化数据段中数据又可分为`只读数据段`和`读写数据段`。只读数据段是程序使用的一些不会被更改的数据，比如常量，同时由于这些变量不需要被修改，因此只需要放置在只读寄存器中即可。`读写数据段`放置的是程序中声明的并且具有初始值的变量，比如全局变量和静态变量。

## 未初始化数据段

未初始化数据段也背称为`BSS段`，即BSS段中存放的数据都是未被初始化的全局变量和静态变量，并默认会把这部分数据初始化为0。 BSS是英文Block Started by Symbol的简称 

>  “未初始化”这一说法其实并不准确，虽然.bss段在编译出的目标文件中是不占 空间的，但是c语言假设在程序的执行之前，运行时启动代码或者操作系统会负责将.bss段清零，而且许多c语言都依赖这一特性。 

## 堆

堆是动态内存分配区，`向高地址增长`，堆中分配内存和释放内存需要调用`malloc\new`和`free\delete`。

## 栈

栈和堆一般相邻(参考图片理解)，但是`沿着相反方向增长`。当栈指针和堆指针相等就说明堆栈内存耗尽(参考图片理解)。每次函数的调用返回地址、参数都被存放在栈中。在进行方法调用时，会先预先分配内存空间，同时函数的栈空间，随着函数调用完成而自动释放。

# C++内存布局

C程序和C++程序布局还是有区别的，C++主要分为以下5个部分

1.  代码段：这部分也C程序大致相同。
2. 常量存储区：这部分存储的内容与C语言中初始化段中的只读数据段是一样的，用来存储C++常量。
3. 全局/静态存储区：在C++中，不在区分数据段和BSS段，未初始化和初始化的全局/静态变量都会存储在这里，并且初始化为0。
4. 堆：分为new分配的储存块和malloc分配的内存块，new分配的存储块在程序结束后，系统会帮助我们清理。
5. 栈：和C相同



# 参数文章

[C/C++内存对齐策略]( http://harlon.org/2018/04/05/cpluscplusmemorypack/ )

[C/C++内存布局策略详解](http://harlon.org/2018/04/21/cpluscplusmemory/ )

























