# 简介

Tcp在在准备发送一段数据前，不是直接进行发送，而是先进行连接前做一些准备工作，来保证连接的可靠性，而不是发送了数据就石沉大海。

<img src="https://s2.ax1x.com/2020/01/06/lrd6OI.png" style="zoom:50%;" />

# 为什么要三次握手

TCP三次的主要原因是为了保证数据可靠传输和效率：1、确认双方都准备好通信了，2、交换数据序列号（重点）。

**注意：**: 除了交换彼此的初始序列号，三次握手的另一个重要作用是交换一些辅助信息，比如最大段大小（MSS）、窗口大小（Win）、窗口缩放因子（WS)、是否支持选择确认（SACK_PERM）等

<img src="https://s2.ax1x.com/2020/01/06/lrw9XR.png" style="zoom:50%;" />

TCP握手只能确认双方准备好通信了，毕竟数据丢失等是每一次数据交互都可能发生的，你只能去劲量避免，不可能完全解决的。

当然我们也可以进行二次，但是两次就会出现我只能确认到了客服端的isn，但是服务端返回的客户端不一定收到了，服务端不知道客户端的情况，所以两次不可取。

**4次**

4次的情况可能是这样：

1. a发送syn+ISN
2. b回复ACK
3. b发送ISN
4. a回复ACK。

这样看，我们一看就知道2、3可以合并，也就是TCP三次了，所以TCP三次也是有原因的。

**为什么单ACK不需要ISN了?**

因为ACK并没有数据，只是一个确认而已，而SYN是有数据的，这个数据就是SYN标志位。

**注意：**凡是消耗序列号的 TCP 报文段，一定需要对端确认。如果这个段没有收到确认，会一直重传直到达到指定的次数为止。

