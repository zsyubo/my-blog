# 编码

为什么说编码了，因为计算机内存、硬盘本质就是一堆二进制数组，既然是一堆二进制，那么一个简单的`hello.c`计算机如如何存储并暂时的了？答案就是`编码`。

编码有很多种，从最初只能存英文的`ASCII`到后来的`UTF-8`，计算机就是靠这套编码来存储并展示的，就是一个暗号表。

ASCII 码使用指定的7 位或8 位[二进制数](https://baike.baidu.com/item/二进制数)组合来表示128 或256 种可能的[字符](https://baike.baidu.com/item/字符)(一般是8位)。计算机在读取源码文件数据时，会一个字节一个字节的读取，然后进行翻译展示到屏幕上，当然现在一般都是使用`utf-8`存储，但是本质是一样的。

上面说的这些，本质就是想表达：计算机信息的本质就是一堆二进制，一串比特表示的，区分不同数据对象的唯一方法就是我们读取这些数据对象的上下文(编码)。

# 编译

有了源文件，写过代码都知道需要进行编写才能执行。同时编译原理也是非常高深的一门课程。

比如前面的`hello.c`，c语言是一种高级语言，计算机看不懂，所以需要先进行编译，编译为底层的机器指令，然后按照一种为可执行文件的格式打包好，才能进行执行。c语言在linux上可以使用GCC编译。

```shell
gcc -o hello hello.c
```

表面上看，一条命令就搞定了，但是低层是分为好几步的。

![](https://s2.ax1x.com/2019/11/10/MuX4PI.png)

## 预处理阶段

预处理器会根据源文件中字符以`#号`开头的命令，然后修改原始c程序，比如c程序一般都有的`#include <stdio.h>`，此行会告诉预处理器去读取`stdio.h`中的内容，并把它直接插入到程序文本中(如果重复引用多次就会有有了重定义的问题)。结果就得到了另一个C程序。通常是以`.i`作为文件拓展名。

## 编译阶段

编译器(ccl)将文本文件`hello.i`翻译成文本文件`hello.s`,他包含一个汇编语言程序。

## 汇编阶段

汇编器(as)会讲`hello.s`翻译成机器语言格式，并把这些指令打包成一种叫做`可重定位目标程序`的格式，并保存到`hello.o`当中，此文件时一个二进制文件。具体格式不同平台而不同。

## 连接阶段

我们写的代码很多时候需要调用系统的API，比如打印到控制台:`printf`是每个C编译器都会提供的标准C库中的一个函数。`printf`函数存在一个名为`printf.o`的单独的预编译好的目标文件或者那个，而这个文件将会以某种方式合并到我们的`hello.o`程序中。连接器(ld)负责处理这种合并中。

最终等到hello可执行文件，使用时会被加载内存中，由系统执行。

# 运行程序

在linux上我们可以使用一下命令来运行刚编译好的程序

```shell
# ./hello 
hello world.
```

一样，表面上看起来很简单，但是底层你懂得

## 系统的硬件组成

<img src="https://s2.ax1x.com/2019/11/10/MuzyYd.md.png" style="zoom:50%;" />

此图是一个典型的计算机的硬件组成。

1. **总线**

   贯穿整个系统的一组电子管道，它主要的作用是携带字节信息并负责在各个部件间传递，总线一般设计成传送定长的字节块。32位机一般是4个字节，64位机是8个字节。

2. **IO设备**

   IO设备是指与外部世界的联系通道

3. 主存

   主存是一个临时存储设备，在程序执行阶段用来存储程序和程序处理的数据。

4. 处理器

   CPU，用来解释执行存储在主存中指令的引擎。

## 运行一个程序

1. 当shell程序执行`./hello`命令时，shell程序会将字符逐一读入寄存器，并放到内存中。

   <img src="https://s2.ax1x.com/2019/11/10/MK9Uln.md.png" alt="avat" style="zoom:50%;" />

2. 一旦程序被加载到了主存，处理器就开始执行程序main中机器指令代码，这些指令将`hello world`字符串的字节从主内存复制到寄存器文件，在从寄存器复制到显示设备最终显示到我们屏幕上。

   <img src="https://s2.ax1x.com/2019/11/10/MK9R61.png" alt="avat" style="zoom:50%;" />

# 操作系统

操作系统可以看成应用程序和硬件之间插入的一层软件。

操作系统有两大基本功能：

1. 防止硬件被失控的应用程序滥用。
2. 想应用程序提供简单一致的机制来控制复杂且不同的低级硬件设备。

